//Shakil Rafi
//APCS2 pd4
//HW 25 -- What a Racket
//2017-03-27

public class Racket  {

    public static String[] tokenize(String exp) {
	return exp.split("\\s+");
    }

    public static Double parse(String s) {
	String[] tokens = tokenize(s);
	LLStack<Integer> parens = new LLStack<Integer>();
	LLStack<String> ops = new LLStack<String>();
	LLStack<Double> nums = new LLStack<Double>();
	for (int i = 0; i < tokens.length; i++) {
	    char c = tokens[i].charAt(0);
	    if (c == ')') {
		char op = ops.pop().charAt(0);
		Double temp = nums.pop();
		int lim = parens.pop() + 2;
		if (op == '+') {
		    for (int j = i - 1; j > lim; j--) {
			temp += nums.pop();
		    }
		} else if (op == '-') {
		    temp *= -1;
		    for (int j = i - 1; j > lim + 1; j--) {
			temp -= nums.pop();
		    }
		    temp += nums.pop();
		} else if (op == '*') {
		    for (int j = i - 1; j > lim; j--) {
			temp *= nums.pop();
		    }
		}
		nums.push(temp);
	    } else if (c == '(') {
		parens.push(i);
	    } else if (c == '+' || c == '-' || c == '*') {
		ops.push(c+"");
	    } else {
		nums.push(Double.parseDouble(tokens[i]));
	    }
	}
	return nums.pop();
    }
    
    public static void main(String[] args) {
	System.out.println(parse("( + 1 2 ( + 1 2 ) )"));
    }
    
}
